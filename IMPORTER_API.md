# Importer API

## Overview

In order to add document to the corpus, you need at least one importer (eg wos importer). Importers are web service which implement the following api.

## API definition 

| Verb | Entrypoint | Available parameter| Description |
|---|---|---|---|
| GET | /api/v1/info | none | Return the current status, the data states and the supported operation of the importer |
| GET | /api/v1/documents | none, ids, stardId, startYear, startMonth, cursor, query | Return the documents requested to the importer |


### Importer document API definition

The documents entrypoint can be use to launch an import and return documents, a json document is return as response. This json document contains two section. The metaData Section contains information of the returned document (an iterator, the number of document and the progression). The data section contains some document. Importers should not send all document at on time. The PCC will pull the importer as often as possible de get a small amount of document. When the last document has been returned, the importer should send a finish message.

The entrypoint has several parameters :

 * If there is no parameter and if the importer support this mode, all document are return by the importer (/api/v1/documents)
 * If you want many ids, you can specify an id list with the parameters ids (/api/v1/documents?ids=[1,2,3...])
 * If the importer support it, you can specify a start year and start month with the parameter startYear and startMonth
 * The api defini to the possibility to make a full text search on an importer. I can be achive trough /api/v1/documents/?query where A is the search expression.
 * If you have perform a big query, the importer will retrieve the document by using an iterator, you can achiveve this bug using cursors provided in the metadata section /api/v1/documents/cursor=123325235432. Cursor are token generated by importers. The PCC will use them to get the next or previous document.
 * To improve search relevancy or reduce the number of result, few standart filter have been defined, tu use them, pass the filter name and value as parameter in the URL, filter are supported by search and getAll mode /api/v1/documents/search?queryParams=A&year=2015

The api return a list of document, the tab below describe the structure of these documents, in some case when the document have not been yet procceded, a busy status can be return. When the end of the pagination is reach, the status metadata change from working to finish and no next cursor is sent.

#### Response metadata section dictionnary

| Element name | Type | Possible value| Comment | Optionnal |
|---|---|---|---|---|
| count | number | number | number of document present is the response | false | 
| first | number | number | id of the first document in the response | false | 
| message | string | string | a message | true |
| nextCursor | string | a token generated by the importer |  | true |
| previousCursor | string | a token generated by the importer |  | true |
| status | string | WORKING, FINISHED, NOT_FOUND, ERROR, BUSY |  | false |
| totalCount | number | number | total number of document for this query | false |

#### Response data section dictionnary

| Element name | Type | Possible value| Comment | Optionnal |
|---|---|---|---|---|
| id | number| number|the id of the document generated by the importer (sequence 1 - n) | false|
| sourceId| string|string | the id of the document from the pusblisher or webSite| true|
| doi| object| confidence : string, value : string| digital object identifier|true |
| type| string|PROPOSAL, PUBLICATION, PROCEEDING, MEETING_ABSTRACT, REVIEW, LETTER, THESIS,PATENT, UNKNOWN | the type of the document| true|
| subType| string| PREPRINT, FINAL, UNKNOWN| the type of the document| true|
| shortName| string| string| the shortName of the document| true|
| articleUrl| string| url| url of the article from the publisher| true|
| title| object| confidence : string, value : string| the title of the document| true|
| abstract| object| value : string, confidence : string| the abstract of the document| true|
| releaseDate| object| value: "YYYY-MM-DDThh:mm:ssZ", confidence : string| the release date of the document| true|
| laboratories|list object| name : string, shortname :  string optionnal, address : string optionnal, city : string optionnal, country : string optionnal, list person id, confidence : string| laboratory object, contains a name, shortname, address, city, country and a list of person id.|true |
| persons| list object| publicationName : string, firstName : string optionnal, lastName : string optionnal, orcid_id : string optionnal, research_id : string optionnal, email : string optionnal, laboratory id :  number, confidence : string| person details including the laboratory id| true|
| instruments  | list object | shortName : string, name : string, laboratory id, experimentTechniques id :  number, formla id, confidence : string| instruments details including the laboratory id| true|
| experimentTechniques|list  object| name : string, instruments id :  list number, confidence : string|the experimental technique |true |
| keywords| list object| value : string, confidence : string| keywords| true|
| formula| list object| code :  string, consistance : string, temperature : number, pressure : number, magneticfield : number, instruments id :  number, confidence : string| | |
| references| list object| value : string, confidence :  string| publication cited by the current publication| true|
| citations| list object| name : string, confidence : string| publication which cite the current publication| true|
| journal| object| name : string, confidence : string| publication journal| true|
| publishers| list object| name : string, city : string, address : string, confidence : string | publication publisher| publocation publisher|
| researchDomains| list object| name : string, confidence : string | publication researchDomain| true|
| fileToDownload| list object| url : string, urlType : string, type, string, confidence : string | the url used to download the pdf| true|
| files|list  object | data : string, name : string,  md5 : string, minetype : string, originUrl : string, type : string| true|
| additionnalText| list object| object| contains additionnal text fragment to analyse. Searchable data type must can be specified, if null, the pcc will look for all data type : DOI, PERSON, ORCIRD_ID, EMAIL, LABORATORY, INSTRUMENT EXPERIMENTAL_TECHNIQUE, FORMULA, REFERENCE, CITATION, RESEARCH_DOMAIN, JOURNAL, PUBLISHER| true|


### Importer example info response

```json 
    {
        "importerName": "wos_importer",
        "providedMetaData":{
            "id": "provided",
            "doi": "provided",
            "title": "provided",
            "abstract": "provided",
            "releaseDate": "provided",
            "documentType": "provided",
            "originURL": "provided",
            "person": "provided",
            "orcid_id": "partial",
            "email": "partial",
            "laboratory": "provided",
            "instrument": "never",
            "experimentTechnique": "never",
            "keyword": "provided",
            "formula": "never",
            "reference": "provided",
            "citation": "provided",
            "researchDomain": "provided",
            "journal": "provided",
            "publisher": "provided"
        },
        "supportedOperations": {
            "getAll": false
        },
        "supportedQueryFilter": {
            "year": true,
            "month": true
            "query":true,
            "startId":true
        }
    }
```

### Importer example document response

```json 
{
    "metadata": {
        "nextCursor": 123532,
        "previousCursor": 43243,
        "status": "finished",
        "count": 454,
        "totalCount": 12354,
        "first":1
        "message": "..."
    },
    "data": [{
        "id": 1,
        "sourceId": "WOS:54446441486423",
        "doi": {
            "value": "doi:10.1340/309registries",
            "confidence":"SURE"
        },
        "type": "publication",
        "subType" : "preprint",
        "shortName": "EXIL",
        "title": {
            "value":"Evaluation of Bending Strain in Nb3Sn Strands of CIC Conductor Using Neutron Diffraction",
            "confidence":"SURE"
        },
        "abstract": {
            "value": "The superconducting property .....",
            "confidence": "SURE"
        },
        "releaseDate": {
            "value":"1988-01-24T10:12:15Z",
            "confidence":"sure"
        },
        "laboratories": [{
            "id": 1,
            "name": "insitut laue langevin",
            "shortname": "ILL",
            "address": "71 avenue des martyr",
            "city": "grenoble",
            "country": "france",
            "confidence" : "SURE"
        }],
        "persons": [{
            "publicationName": " S Letreguilly",
            "firstName": "Sylvain",
            "lastName": "Letreguilly",
            "orcidId": "46545345",
            "researcherId": "4555454656",
            "email": "letreguilly@gmail.com",
            "laboratoryId": 1,
            "confidence": SURE"
        }, {
            "publicationName": " A Letreguilly",
            "firstName": "Antoine",
            "lastName": "Letreguilly",
            "orcid_id": "46545345",
            "research_id": "4555454656",
            "email": "aletreguilly@gmail.com",
            "laboratoryId": 1,
            "confidence": SURE"
        }, {
            "publicationName": " F Letreguilly",
            "firstName": "Fabien",
            "lastName": "Letreguilly",
            "orcid_id": "46545345",
            "research_id": "4555454656",
            "email": "fletreguilly@gmail.com",
            "laboratoryId": 2,
            "confidence": SURE"
        }],
        "instruments": [{
            "name": "D10 diffractormeter",
            "shortName": "D10",
            "experimentTechniquesIds": [2],
            "laboratoryId": 1,
            "confidence": SURE"
        }, {
            "name": "D11 super diffractormeter",
            "shortName": "D11",
            "experimentTechniquesIds": [1, 2],
            "laboratoryId": 1,
            "confidence": SURE"
        }],
        "experimentTechniques": [{
            "id": 1,
            "name": "neutron scattering",
            "confidence": "SURE"
        }, {
            "id": 2,
            "name": "neutron diffraction",
            "confidence":"SURE"
        }],
        "keywords": [{
            "value":"neutron",
            "confidence": "SURE"
        }, {
            "value": "diffraction",
            "confidence" : "SURE"
        }],
        "formulas": [{
            "code": "KMnO4",
            "consistence": "liquid",
            "temperature": "282.012K",
            "pressure": "10000Pa",
            "magneticField": "0T",
            "confidence": SURE"
        }],
        "references": [{
            "value" : "reference 1",
            "confidence" : "SURE"
        }],
        "citations": [{
            "value" : "reference 1",
            "confidence" : "SURE"
        }, {
            "value" : "reference 1",
            "confidence" : "SURE"
        }],
        "journal": {
            "name": "nature",
            "confidence":"SURE"
        },
        "publishers": [{
            "name": "elsevier",
            "city": "london",
            "address": "anywhere",
            "confidence": "sure"
        }],
        "researchDomains": [{
            "value" : "science"
            "confidence" : "SURE"
        },{
            "value": "neutron",
            "confidence":"SURE"
        }],
        "files": [{
            "data": "F?IVCZV?EFNJVFOEQGJFCOG?FJ43JGCRQEJG49Q?VJRQE?GJEQ?J59?QGJE9Q?RJDFC",
            "name": "fdsfds.pdf",
            "md5": 12534325435,
            "mimeType": "application/pdf",
            "originUrl": "http://...",
            "type": "PROPOSAL/REPORT/..."
        }],
         "filesToDownload": [{
             "confidence":"SURE",
             "url": "http://....",
             "urlType": "ARTICLE_PAGE"/"PDF",
              "type": "PROPOSAL/REPORT/..."
         }],
        "additionalTexts":[{
            "text": "ghfdlhgsfjkldghjklsfdghsdjklfghskllvlsdfhvkjslkdfvhksjdf",
            "dataTypes": ["formula","members", "...."]
        }]
    }]
}
```